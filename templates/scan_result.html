<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvoiceSnap ‚Äî Scan Result</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', sans-serif; background: #0B0F1A; min-height: 100vh; }
        .topbar { background: #141926; border-bottom: 1px solid #2A3148; padding: 14px 24px; display: flex; align-items: center; justify-content: space-between; }
        .topbar h1 { font-size: 20px; font-weight: 700; color: #E8ECF4; }
        .topbar h1 span { color: #3B82F6; }
        .topbar a { font-size: 13px; color: #8B95B0; text-decoration: none; padding: 8px 14px; border-radius: 8px; }
        .main { max-width: 800px; margin: 0 auto; padding: 24px; }
        h2 { font-size: 22px; font-weight: 700; color: #E8ECF4; margin-bottom: 8px; }
        .subtitle { color: #8B95B0; font-size: 14px; margin-bottom: 24px; }
        .success-bar { background: rgba(74,222,128,.1); border: 1px solid rgba(74,222,128,.2); border-radius: 10px; padding: 14px 18px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .success-bar span { font-size: 14px; color: #4ADE80; font-weight: 500; }
        .card { background: #141926; border-radius: 12px; padding: 24px;  margin-bottom: 20px; }
        .card h3 { font-size: 15px; font-weight: 700; color: #E8ECF4; margin-bottom: 16px; padding-bottom: 10px; border-bottom: 1px solid #f1f5f9; }
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .form-group { margin-bottom: 14px; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: #E8ECF4; margin-bottom: 5px; }
        .form-group input, .form-group textarea { width: 100%; padding: 10px 12px; border: 1.5px solid #2A3148; border-radius: 8px; font-size: 14px; font-family: 'DM Sans', sans-serif; }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: #3B82F6; }
        .items-list { margin-bottom: 12px; }
        .item-row { display: grid; grid-template-columns: 3fr 1fr 1fr 1fr; gap: 8px; padding: 8px 0; border-bottom: 1px solid #f1f5f9; font-size: 14px; }
        .item-row.header { font-weight: 600; color: #8B95B0; font-size: 12px; text-transform: uppercase; }
        .total-section { text-align: right; padding-top: 12px; }
        .total-line { font-size: 14px; color: #8B95B0; margin-bottom: 4px; }
        .total-line strong { color: #E8ECF4; }
        .total-grand { font-size: 20px; font-weight: 700; color: #3B82F6; margin-top: 8px; }
        .actions { display: flex; justify-content: flex-end; gap: 12px; }
        .btn { padding: 13px 28px; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; font-family: 'DM Sans', sans-serif; text-decoration: none; display: inline-block; }
        .btn-primary { background: #3B82F6; color: #fff; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-secondary { background: #2A3148; color: #E8ECF4; }
        .btn-secondary:hover { background: #2A3148; }
    </style>
</head>
<body>
    <div class="topbar">
        <a href="/login" style="text-decoration:none;color:inherit"><h1>Invoice<span>Snap</span></h1></a>
        <a href="/">‚Üê Dashboard</a><a href="https://snapsuite.up.railway.app" target="_blank" style="font-size:11px;color:#8B95B0;text-decoration:none;padding:5px 10px;border:1px solid #2A3148;border-radius:6px;font-weight:600">Suite</a><div style="position:relative;display:inline-block"><button onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='block'?'none':'block'" style="font-size:14px;background:none;border:1px solid #2A3148;border-radius:6px;padding:5px 10px;color:#8B95B0;cursor:pointer" title="Switch App">‚äû</button><div style="display:none;position:absolute;right:0;top:32px;background:#141926;border:1px solid #2A3148;border-radius:10px;padding:8px;min-width:180px;z-index:200;box-shadow:0 8px 30px rgba(0,0,0,.5)"><a href="https://expensesnap.up.railway.app" style="display:block;padding:8px 12px;color:#E8ECF4;text-decoration:none;border-radius:6px;font-size:13px;font-weight:500" onmouseover="this.style.background='#2A3148'" onmouseout="this.style.background='none'">üì∏ ExpenseSnap</a><a href="https://contractsnap-app.up.railway.app" style="display:block;padding:8px 12px;color:#E8ECF4;text-decoration:none;border-radius:6px;font-size:13px;font-weight:500" onmouseover="this.style.background='#2A3148'" onmouseout="this.style.background='none'">üìã ContractSnap</a><a href="https://payslipsnap.up.railway.app" style="display:block;padding:8px 12px;color:#E8ECF4;text-decoration:none;border-radius:6px;font-size:13px;font-weight:500" onmouseover="this.style.background='#2A3148'" onmouseout="this.style.background='none'">üí∞ PayslipSnap</a><a href="https://proposalsnap.up.railway.app" style="display:block;padding:8px 12px;color:#E8ECF4;text-decoration:none;border-radius:6px;font-size:13px;font-weight:500" onmouseover="this.style.background='#2A3148'" onmouseout="this.style.background='none'">üéØ ProposalSnap</a></div></div>
    </div>

    <div class="main">
        <h2>‚úÖ Invoice Scanned</h2>
        <p class="subtitle">Review the extracted details below. Edit anything that looks wrong, then save.</p>

        <div class="success-bar">
            <span>‚úì AI successfully extracted invoice details</span>
        </div>

        <form method="POST" action="/save-scanned">
            <input type="hidden" name="scan_data" value='{{ data | tojson }}'>

            <div class="card">
                <h3>From: {{ data.vendor_name or 'Unknown Vendor' }}</h3>
                <p style="font-size:13px;color:#8B95B0;margin-top:-10px;margin-bottom:10px;">{{ data.vendor_address or '' }}</p>

                <div class="row">
                    <div class="form-group">
                        <label>Bill To (Client Name)</label>
                        <input type="text" name="client_name" value="{{ data.client_name or '' }}">
                    </div>
                    <div class="form-group">
                        <label>Client Email</label>
                        <input type="email" name="client_email" value="{{ data.client_email or '' }}">
                    </div>
                </div>
                <div class="form-group">
                    <label>Client Address</label>
                    <textarea name="client_address" rows="2">{{ data.client_address or '' }}</textarea>
                </div>
            </div>

            <div class="card">
                <h3>Invoice Details</h3>
                <div class="row">
                    <div class="form-group">
                        <label>Invoice Number</label>
                        <input type="text" value="{{ data.invoice_number or '' }}" readonly style="background:#0B0F1A;">
                    </div>
                    <div class="form-group">
                        <label>Currency</label>
                        <input type="text" value="{{ data.currency or 'CAD' }}" readonly style="background:#0B0F1A;">
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Issue Date</label>
                        <input type="date" name="issue_date" value="{{ data.issue_date or '' }}">
                    </div>
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" name="due_date" value="{{ data.due_date or '' }}">
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Line Items</h3>
                <div class="items-list">
                    <div class="item-row header">
                        <span>Description</span>
                        <span style="text-align:right">Qty</span>
                        <span style="text-align:right">Price</span>
                        <span style="text-align:right">Amount</span>
                    </div>
                    {% for item in data.get('items', []) %}
                    <div class="item-row">
                        <span>{{ item.description }}</span>
                        <span style="text-align:right">{{ item.quantity }}</span>
                        <span style="text-align:right">{{ curr_symbol }}{{ "%.2f"|format(item.unit_price) }}</span>
                        <span style="text-align:right;font-weight:600;">{{ curr_symbol }}{{ "%.2f"|format(item.amount) }}</span>
                    </div>
                    {% endfor %}
                </div>

                <div class="total-section">
                    <div class="total-line">Subtotal: <strong>{{ curr_symbol }}{{ "%.2f"|format(data.get('subtotal', 0)) }}</strong></div>
                    {% for tax in data.get('tax_details', []) %}
                    <div class="total-line">{{ tax.label }} ({{ tax.rate }}%): <strong>{{ curr_symbol }}{{ "%.2f"|format(tax.amount) }}</strong></div>
                    {% endfor %}
                    {% if data.get('discount', 0) > 0 %}
                    <div class="total-line">Discount: <strong>-{{ curr_symbol }}{{ "%.2f"|format(data.discount) }}</strong></div>
                    {% endif %}
                    <div class="total-grand">{{ curr_symbol }}{{ "%.2f"|format(data.get('total', 0)) }}</div>
                </div>
            </div>

            <div class="actions">
                <a href="/scan" class="btn btn-secondary">Scan Another</a>
                <button type="submit" class="btn btn-primary">üíæ Save Invoice</button>
            </div>
        </form>
    </div>
</body>
</html>
